language: go, node_js

go:
  - 1.17

node_js:
  - 14.19.1

jobs:
  include:
    - 
      os: linux
      dist: focal
    - 
      os: osx
    -
      os: windows

compiler:
  - gcc

before_install:
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v1.44.2 ; fi
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then sudo apt-get install gcc libgtk-3-dev libayatana-appindicator3-dev -y ; fi
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then make dep ; fi
  - if [ "$TRAVIS_OS_NAME" == "linux" ]; then /bin/bash ci_scripts/create-ip-aliases.sh ; fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v1.44.2 ; fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then make dep ; fi
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then /bin/bash ci_scripts/create-ip-aliases.sh ; fi
  - if [ "$TRAVIS_OS_NAME" == "windows"]; then choco install make ; fi
  - if [ "$TRAVIS_OS_NAME" == "windows"]; then go install github.com/golangci/golangci-lint/cmd/golangci-lint@v1.44.2 ; fi
  - if [ "$TRAVIS_OS_NAME" == "windows"]; then make dep ; fi

before_script:
  - if [ "$TRAVIS_OS_NAME" == "linux"]; then make check ; fi
  - if [ "$TRAVIS_OS_NAME" == "osx"]; then make check ; fi
  - if [ "$TRAVIS_OS_NAME" == "windows"]; then set GO1111MODULE=on ; fi
  - if [ "$TRAVIS_OS_NAME" == "windows"]; then make check-windows ; fi

script:
  - if [ "$TRAVIS_OS_NAME" == "linux"]; then make build ; fi
  - if [ "$TRAVIS_OS_NAME" == "linux"]; then make build-systray ; fi
  - if [ "$TRAVIS_OS_NAME" == "osx"]; then make build ; fi
  - if [ "$TRAVIS_OS_NAME" == "windows"]; then make build-windows ; fi
  - if [ "$TRAVIS_OS_NAME" == "windows"]; then make build-systray-windows ; fi
